<html>
    <head>
        <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/pure-min.css">
        <link href='https://fonts.googleapis.com/css?family=Roboto:500,300|Monofett' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.6/moment.min.js"></script>
        <script src="skycons.js"></script>
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta http-equiv="refresh" content="1800">

<!--         <script>
            var pushedTime
            setInterval(function() {
              $.getJSON("http://api.github.com/repos/taramk/taramk.github.io", null, function(data) {
                  if (pushedTime != null && pushedTime != data.pushed_at) {
                    window.location.href = window.location.href
                  }
                  pushedTime = data.pushed_at
                })
            }, 3000)
        </script> -->



        <style>
            body {
                font-family: "Roboto";
                background-color: #000;
                color: #fff;
                font-weight: 300;
                line-height: 1;
                font-size: 65px;
            }
            #today {
                width: 100%;
                margin: 0 auto;
            }
            p { margin: 5px; }
            .thin { font-weight: 300; }
            #datetimediv { float: left; }
            #time, #temp { font-size: 168px; font-weight: 500; }
            #tempdiv, #predictionsdiv {
                float: right;
                text-align: right;
            }
            #summary { float: right; font-size: 40px; width: 50%; text-align: right; margin-top: 100px;}
            #predictionsdiv {
                margin-top: 100px;
            }
            .night { color: #000; }
            .night#time { color: #555; }
            .day { color: #fff; }
            .mono { font-family: "Monofett"; }

        </style>

        <script>
            $( document ).ready(function() {
                var apiKey = '924e9d9107d45f7ecb44b283db5bc86b';
                var url = 'https://api.forecast.io/forecast/';
                var lat = 37.7608960;
                var lon = -122.4380300;
                var data;

                var skycons = new Skycons({"color": "white"});

                // night time mode: hide everything, darken time
                function setTextColor() {
                    var hour = new Date().getHours();
                    // skycons.color = "white";
                    //css classes control text colors
                    if (hour > 22 || hour < 6) {
                        $("p").addClass("night");
                        // document.getElementById("icon").style.display = "none";
                    } else {
                        $("p").addClass("day");
                        // document.getElementById("icon").style.display = "visible";
                    }
                }

              var refresh = function() {
                  $.ajax({
                    type: "GET",
                    url: "http://webservices.nextbus.com/service/publicXMLFeed?command=predictions&a=sf-muni&stopId=15728&useShortTitles=true",
                    dataType: "xml",
                    success: function(xml) {
                            showPredictions(xml);
                            $('#predictionsdiv').xml(xml);
                            setTimeout(function() {
                                refresh();
                            }, interval);
                        }
                  });
                };
                refresh();

                // get date and time and populate html, run every 1000ms. check whether it should be night mode.
                setInterval(function(){
                    var date = moment().format('dddd[ the ]Do');
                    var time = moment().format('H:mm');
                    setTextColor();
                    $('#date').html(date);
                    $('#time').html(time);
                }, 1000);


                // get weather, icon and populate html + canvas, re-run every 2 mins
                function forecast(){
                    $.getJSON(url + apiKey + "/" + lat + "," + lon + "?callback=?", function(data) {
                      console.log(data);

                        $('#temp').html(Math.round(data.currently.temperature) + '&deg;F ');
                        $('#highlow').html(Math.round(data.daily.data[0].temperatureMax) + '&deg;F&uarr;&ensp;' + Math.round(data.daily.data[0].temperatureMin) + '&deg;F&darr;')
                        $('#summary').html(data.daily.summary.toLowerCase())
                        // skycons.add(document.getElementById("icon"), data.currently.icon);
                        // skycons.play();
                    });
                    setTimeout(forecast, 120000)
                }
                forecast();


                // get muni route info
                var direction = "";
                var route = "";

                function showPredictions(xml) {
                  $(xml).find("predictions").each(function() {
                    route = $(this).attr("routeTag");
                    $(this).find("direction").each(function() {
                      $("#predictionsdiv").append("<span class='mono'>" + route + "</span> ");
                      $(this).find("prediction").each(function() {
                        $("#predictionsdiv").append($(this).attr("minutes") + "<br>");
                        if ( $(this).index() == 0 ) {
                          return false;
                        }
                      });
                      // $("#predictionsdiv").append("<br />");
                    });
                  });
                }

            });

        </script>

    </head>

    <body>

        <div id="today">
            <div id="datetimediv">
                <p id="date"></p>
                <p id="time">
            </div>

            <div id="tempdiv">
                <p id="temp"></p>
                <p id="highlow"></p>

                <!-- <canvas id="icon" width="200" height="200"></canvas> -->
            </div>

            <div id="summary" style="clear: both;"></div>

            <div id="predictionsdiv" style="clear: both;"></div>

        </div>



    </body>
</html>