<html>
    <head>
        <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/pure-min.css">
        <link href='https://fonts.googleapis.com/css?family=Roboto:500,300' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.6/moment.min.js"></script>
        <script src="skycons.js"></script>
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta http-equiv="refresh" content="1800">

<!--         <script>
            var pushedTime
            setInterval(function() {
              $.getJSON("http://api.github.com/repos/taramk/taramk.github.io", null, function(data) {
                  if (pushedTime != null && pushedTime != data.pushed_at) {
                    window.location.href = window.location.href
                  }
                  pushedTime = data.pushed_at
                })
            }, 3000)
        </script> -->



        <style>
            body {
                font-family: "Roboto";
                padding: 5%;
                background-color: #000;
                color: #fff;
                font-weight: 500;
                font-size: 112px;
                text-align: right;
            }
            p {
                margin: 5px;
            }
            .thin {
                font-weight: 300;
            }
            #time {
                font-size: 168px;
            }
            #highlow {
                font-size: 84;
            }
            .night {
                color: #000;
            }
            .night#time {
                color: #555;
            }
            .day {
                color: #fff;
            }

        </style>

        <script>
            $( document ).ready(function() {
                var apiKey = '924e9d9107d45f7ecb44b283db5bc86b';
                var url = 'https://api.forecast.io/forecast/';
                var lat = 37.7608960;
                var lon = -122.4380300;
                var data;

                var skycons = new Skycons({"color": "white"});

                // night time mode: hide everything, darken time
                function setTextColor() {
                    var hour = new Date().getHours();

                    skycons.color = "white";

                    //css classes control text colors
                    if (hour > 22 || hour < 6) {
                        $("p").addClass("night");
                        document.getElementById("icon").style.display = "none";
                    } else {
                        $("p").addClass("day");
                        document.getElementById("icon").style.display = "visible";
                    }

                }

                // get date and time and populate html, run every 1000ms. check whether it should be night mode.
                setInterval(function(){
                    var date = moment().format('dddd [the] Do');
                    var time = moment().format('H:mm');

                    setTextColor();

                    $('#date').html(date);
                    $('#time').html(time);
                }, 1000);



                // get weather, icon and populate html + canvas, re-run every 2 mins
                function forecast(){
                    $.getJSON(url + apiKey + "/" + lat + "," + lon + "?callback=?", function(data) {
                      console.log(data);

                        $('#temp').html(Math.round(data.currently.temperature) + '&deg;F ' + '<span class="thin">' + data.currently.summary.toLowerCase() + '</span>');
                        $('#highlow').html(Math.round(data.daily.data[0].temperatureMax) + '&deg;F&emsp;' + Math.round(data.daily.data[0].temperatureMin) + '&deg;F')
                        skycons.add(document.getElementById("icon"), data.currently.icon);
                        skycons.play();
                    });
                    setTimeout(forecast, 120000)
                }
                forecast();

            });
        </script>

    </head>

    <body>

        <div id="today">

            <p id="date" class="thin"></p>
            <p id="time"></p>
            <p id="temp"></p>
            <p id="highlow" class="thin"></p>
            <canvas id="icon" width="200" height="200"></canvas>
        </div>


    </body>
</html>